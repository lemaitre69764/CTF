# TsukiCTF: Flash Memory — Writeup

## Описание

В задании необходимо было проходить раунды, в которых показываются цифры. Некоторые из них отображаются, некоторые — скрыты. После 10 раундов нужно ввести сумму всех 10 чисел, каждое из которых состоит из 7 цифр.

## Анализ

Во время анализа через Burp Suite стало видно, что сервер сохраняет данные сессии во Flask cookie. Расшифровав cookie (с помощью `flask-unsign`), удалось получить значение `session_id`.

Далее при изучении кода на сервере стало понятно, что генерация цифр полностью детерминирована. Используется LCG (линейный конгруэнтный генератор), параметры которого вычисляются через HMAC от `seed` и `session_id`. Таким образом, если у нас есть и `seed`, и `session_id`, мы можем воспроизвести все числа.

Стоит отметить, что `seed.txt`, лежащий в папке `static`, доступен на сайте. Его содержимое можно прочитать напрямую. Это важно, так как файлы, приложенные к заданию в архиве, обычно подменяются, и в них может быть фейковое значение (`REDACTED` вместо настоящего `seed`).

## Эксплуатация

После получения `session_id` и `seed`, был написан простой скрипт, который воспроизводит генерацию всех чисел на основе логики сервера:

```python
from app import generate_round_digits
import hashlib, hmac

SEED = bytes.fromhex("...")  # содержимое /static/seed.txt
session_id = "..."           # извлечён из session cookie

TOTAL_ROUNDS = 10
total = 0

for i in range(TOTAL_ROUNDS):
    digits = generate_round_digits(SEED, session_id, i)
    number = int(''.join(map(str, digits)))
    total += number

print(f"Итоговая сумма: {total}")
После этого нужно было ввести полученную сумму на странице /result, и задача засчитана.


TsukuCTF25{...REDACTED...}
